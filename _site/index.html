<h2 id='1_menu'>1. Menu</h2>

<ol>
<li>Menu</li>

<li>Requirements</li>

<li>Installation process</li>

<li>Usefull commands</li>

<li>System Setup</li>

<li>Internal global DB structure</li>

<li>Special StudieTimer section</li>

<li>CMS Usage (Not applicable for StudieTimer)</li>
</ol>

<h2 id='2_requirements'>2. Requirements</h2>

<p>The Ikibox Content Management System has the following, recommended, requirements to insure a stable and functioning service.</p>

<ul>
<li>Ubuntu (or any other Linux distribution) though it SHOULD be 64-bit!</li>

<li>Ruby 1.9.3p125</li>

<li>MonogDB v1.8.2</li>

<li>Nginx or Apache (no particular version needed, we recommend Nginx for production)</li>

<li>Redis server v2.2.11</li>
</ul>

<h2 id='3_installation'>3. Installation</h2>

<p>This quide wil ensure a running environment. However it won&#8217;t get into deployment strategies (like Capistrano and GIT setup). The follwing commands can be extremly dangerous, Website-development and Briljandt are not responsible for any damage the following commands could do to your system!</p>

<h3 id='31_update_ubuntu'>3.1 Update Ubuntu</h3>

<p>Update and upgrade Ubuntu (probably with sudo, depending on settings and Linux distribution).</p>

<pre><code>apt-get update
apt-get -y upgrade</code></pre>

<p>Install the build-essentials (problably not installed yet)</p>

<pre><code>apt-get -y install build-essential</code></pre>

<p>Install Git-core.</p>

<pre><code>apt-get -y install git-core</code></pre>

<h3 id='32_rbenv'>3.2 Rbenv</h3>

<p>Website-development has decided to switch from RVM to Rbenv for management of different Ruby versions and gems. The following installation commands are for a system wide installation of Rbenv. If this is now</p>

<p>Download the Rbenv from Github.</p>

<pre><code>git clone git://github.com/sstephenson/rbenv.git /usr/local/rbenv</code></pre>

<p>Now you need to add Rbenv to the path. First create a profile and added RBenv.</p>

<pre><code>echo &#39;# rbenv setup&#39; &gt; /etc/profile.d/rbenv.sh
echo &#39;export RBENV_ROOT=/usr/local/rbenv&#39; &gt;&gt; /etc/profile.d/rbenv.sh
echo &#39;export PATH=&quot;$RBENV_ROOT/bin:$PATH&quot;&#39; &gt;&gt; /etc/profile.d/rbenv.sh
echo &#39;eval &quot;$(rbenv init -)&quot;&#39; &gt;&gt; /etc/profile.d/rbenv.sh</code></pre>

<p>Chmod the just created file.</p>

<pre><code>chmod +x /etc/profile.d/rbenv.sh</code></pre>

<p>And reload.</p>

<pre><code>source /etc/profile.d/rbenv.sh</code></pre>

<p>For easy installation en compilation of different Ruby languages instal Ruby-build:</p>

<pre><code>pushd /tmp
  git clone git://github.com/sstephenson/ruby-build.git
  cd ruby-build
  ./install.sh
popd</code></pre>

<p>Check if Rbenv is installed:</p>

<pre><code>rbenv --version</code></pre>

<h3 id='33_ruby'>3.3 Ruby</h3>

<p>To install Ruby use the following commands.</p>

<pre><code>rbenv install 1.9.3-p125</code></pre>

<p>Make it the default Ruby version (just to make sure it all is working in the future)</p>

<pre><code>rbenv global 1.9.3-p125</code></pre>

<p>And rehash to make Ruby work in the current session.</p>

<pre><code>rbenv rehash</code></pre>

<h3 id='34_install_nginx_and_passenger'>3.4 Install Nginx and Passenger</h3>

<p>First make sure that Nginx is not installed (Passenger will install it when it is done). Note that Nginx does not support loadable, in contrast to most other web servers. This is why it is essential you know what you are doing!</p>

<p>Install Passenger.</p>

<pre><code>gem install passenger</code></pre>

<p>Install the Nginx module for Passenger. And follow the installer (there are problably some things still missing)</p>

<pre><code>passenger-install-nginx-module</code></pre>

<p>Edit the Nginx config file (if you don&#8217;t know VIM, LEARN IT).</p>

<pre><code>vim /opt/nginx/conf/nginx.conf</code></pre>

<p>Replace it with the following, of course edit the file to make it work (change the debug, acces, error and root locations).</p>

<pre><code>#user  nobody; 
worker_processes  1; 
 
events { 
    worker_connections  1024; 
} 
 
 
http { 
    passenger_root /usr/local/rvm/gems/ruby-1.9.3-p125/gems/passenger-3.0.11; 
    passenger_ruby /usr/local/rvm/bin/passenger_ruby; 
 
    include       mime.types; 
    default_type  application/octet-stream; 
 
    passenger_max_pool_size 5; 
    passenger_min_instances 4; 
    passenger_pool_idle_time 0; 
    passenger_log_level 1; 
    passenger_debug_log_file [DEBUG LOG LOCATION]
 
    sendfile        on; 
    tcp_nopush      on; 
    tcp_nodelay     on; 
    keepalive_timeout 65; 
    client_max_body_size 1G; 
    #gzip  on; 
 
    server { 
        listen       *:80; 
        passenger_use_global_queue on; 
 
        #access_log [ACCES LOG LOCATION]
        #error_log [ERRORS LOG LOCATION]
 
        root   [ROOT OF THE APPLICATION]
 
        passenger_enabled on; 
 
    } </code></pre>

<p>start nginx</p>

<pre><code>service nginx start</code></pre>

<h3 id='35_require_gems'>3.5 require gems</h3>

<p>Installing all the required gems is a breeze. This is where Bundler commes in:</p>

<pre><code>gem install bundler</code></pre>

<p>Second install the gems:</p>

<pre><code>bundle install</code></pre>

<h3 id='36_mongodb'>3.6 Mongodb</h3>

<p>Installing mongoDB (probably sudo required).</p>

<pre><code>apt-get install mongodb</code></pre>

<p>Now we need to restore the database. First install tar.</p>

<pre><code>apt-get install tar</code></pre>

<p>Untar db files.</p>

<pre><code>tar -xvjf [tar location] </code></pre>

<p>And restore the files:</p>

<pre><code>mongorestore -d ikibox [Location unzipped DB files]</code></pre>

<p>Start the mongodb server:</p>

<pre><code>sudo mongod --fork
            --dbpath  [Location DB files]
            --logpath [Location DB log]</code></pre>

<h3 id='37_redis'>3.7 Redis</h3>

<p>Redis is used to track background tasks that are issued by the system. Install.</p>

<pre><code>apt-get install redis-server</code></pre>

<p>start.</p>

<pre><code>service start redis</code></pre>

<h3 id='39_imagemagick'>3.9 ImageMagick</h3>

<p>Install libmagick.</p>

<pre><code>apt-get install libmagick9-dev</code></pre>

<h3 id='310_wkhtmltopdf'>3.10 Wkhtmltopdf</h3>

<p>Although WkhtmltoPDF is, probably, not required. It can be a pain to install!</p>

<p>Install lzma</p>

<pre><code>apt-get install lzma</code></pre>

<p>cd to current ruby bin.</p>

<pre><code>cd /usr/local/rvm/gems/ruby-1.9.3-p125/bin/</code></pre>

<p>Download wkhtmltopdf.</p>

<pre><code>wget http://wkhtmltopdf.googlecode.com/files/wkhtmltopdf-0.10.0_beta5-static-amd64.tar.lzma</code></pre>

<p>Test it.</p>

<pre><code>which wkhtmltopdf</code></pre>

<h3 id='4_usefull_commands'>4. Usefull commands</h3>

<p>Starting a production console (from the location of the ikibox root):</p>

<pre><code>RACK_ENV=production bundle exec tux</code></pre>

<h3 id='5_system_setup'>5. System setup</h3>

<p>The Ikibox CMS is based on the MVC pattern (like Rails for example), it is however totally build with Sinatra. The system is build in four distinct parts:</p>

<h4 id='51_websites_controller'>5.1 Websites Controller</h4>

<p>The websites controller is in charge of serving the actual webpages for the virtual stored websites. Virtual trees are created to calculate the most efficient way to different parts in the website (A LOT of tree traversing is done).</p>

<h4 id='52_cms_controller_not_applicable_for_studietimer'>5.2 CMS Controller (Not applicable for StudieTimer)</h4>

<p>The CMS controller is in charge of any request related to CRUD (For good reasons REST is not implemented).</p>

<h4 id='53_code_controller'>5.3 Code Controller</h4>

<p>Due to the implementation of a virtual filesystem and not completed FTP interface, the code controller whas created as a temporary solution to make CRUD actions possible on files. This is the only way to edit the HTML and Ruby files.</p>

<h4 id='54_admin_controller'>5.4 Admin Controller</h4>

<p>The admin controller is the interface to create website and manage the virtual Models, attributes, domains etc.</p>

<h3 id='6_internal_global_db_structure'>6. Internal global DB structure</h3>

<p>The following, flexible, database structure is created to be a dynamic environment which could (theoraticaly) be able to handle any type of data structure.</p>